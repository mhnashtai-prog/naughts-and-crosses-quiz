<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>INTUITY ‚Äì Quiz Battle Arena</title>
<style>
:root{
  --bg:#060606; --muted:#dfeee0; --lime1:#9be56a; --lime2:#5dd26b;
  --blue1:#4a9eff; --blue2:#2563eb;
  --accent-bezier:cubic-bezier(.4,0,.2,1);
  font-family: -apple-system, 'SF Pro Text', 'Helvetica Neue', Arial, sans-serif;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#050606 0%, #071113 100%);color:var(--muted);-webkit-font-smoothing:antialiased}
.container{max-width:980px;margin:22px auto;padding:18px;display:flex;flex-direction:column;gap:18px}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
.brand{display:flex;flex-direction:column}
.brand h1{margin:0;font-size:20px;color:whitesmoke;font-weight:600;letter-spacing:1px}
.brand .sub{font-size:12px;color:rgba(255,255,255,0.7)}
.brand .author{font-size:12px;color:rgba(255,255,255,0.45)}
.statusBar{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.player{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.03);transition:all 0.3s var(--accent-bezier)}
.player.active{border-color:rgba(255,255,255,0.15);box-shadow:0 0 20px rgba(155,229,106,0.2)}
.player .icon{font-size:18px}
.player .meta{font-size:13px}
.boardWrap{display:flex;flex-direction:column;align-items:center;gap:12px}
.board{width:460px;max-width:94vw;padding:18px;border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.45));border:1px solid rgba(255,255,255,0.03);box-shadow:20px 30px 60px rgba(0,0,0,0.7);position:relative;transition:opacity 0.3s var(--accent-bezier)}
.boardHeader{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.small{font-size:13px;color:rgba(255,255,255,0.7)}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.cell{aspect-ratio:1/1;border-radius:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;cursor:pointer;background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(0,0,0,0.3));border:1px solid rgba(255,255,255,0.03);transition:transform .25s var(--accent-bezier),box-shadow .18s;overflow:hidden}
.cell:hover:not(.claimed-X):not(.claimed-O){transform:translateY(-8px) rotateX(2deg);box-shadow:0 14px 30px rgba(0,0,0,0.6)}
.cell .label{position:absolute;top:10px;left:12px;font-size:12px;color:rgba(255,255,255,0.75);font-weight:500}
.cell .symbol{font-size:36px;transition:transform 0.3s var(--accent-bezier)}
.cell.claimed-X{background:linear-gradient(180deg,var(--blue1),var(--blue2));color:#ffffff;box-shadow:0 6px 20px rgba(74,158,255,0.3)}
.cell.claimed-O{background:linear-gradient(180deg,var(--lime1),var(--lime2));color:#04270b;box-shadow:0 6px 20px rgba(155,229,106,0.3)}
.cell.perfect{animation:perfectPulse 0.6s ease-out}
.cell.activeEdge{box-shadow:0 0 24px rgba(155,229,106,0.12);border:1px solid rgba(155,229,106,0.18)}
@keyframes perfectPulse{
  0%{transform:scale(1)}
  50%{transform:scale(1.08);box-shadow:0 10px 40px rgba(155,229,106,0.5)}
  100%{transform:scale(1)}
}
@keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-6px)}50%{transform:translateX(6px)}75%{transform:translateX(-4px)}100%{transform:translateX(0)}}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:12px;z-index:60;background:rgba(0,0,0,0.8);backdrop-filter:blur(8px)}
.modal.show{display:flex;animation:fadeIn 0.2s ease-out}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.panel{width:100%;max-width:520px;border-radius:12px;padding:20px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.5));border:1px solid rgba(255,255,255,0.04);box-shadow:0 30px 60px rgba(0,0,0,0.7);backdrop-filter:blur(6px);position:relative;overflow:hidden;animation:slideUp 0.3s var(--accent-bezier)}
@keyframes slideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
.panelHeader{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.panelBody{display:flex;flex-direction:column;gap:18px;max-height:60vh;overflow-y:auto;padding-right:8px}
.panelBody::-webkit-scrollbar{width:6px}
.panelBody::-webkit-scrollbar-track{background:rgba(255,255,255,0.02);border-radius:3px}
.panelBody::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:3px}
.q{margin-bottom:0}
.q h4{margin:0 0 12px 0;font-size:14px;color:rgba(255,255,255,0.90);font-weight:500;line-height:1.5}
.choices{display:flex;flex-wrap:wrap;gap:10px}
.matchContainer{display:grid;grid-template-columns:1fr 1fr;gap:16px;align-items:start}
.matchLeft,.matchRight{display:flex;flex-direction:column;gap:8px}
.choice{
  padding:12px 16px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);cursor:pointer;
  background:rgba(255,255,255,0.02);font-size:14px;color:rgba(255,255,255,0.85);
  transition:all .2s var(--accent-bezier);box-shadow:0 2px 8px rgba(255,140,40,0.08);
  min-height:44px;display:flex;align-items:center;justify-content:center;user-select:none;
}
.choice:hover{background:rgba(255,255,255,0.04);border-color:rgba(255,255,255,0.12);transform:translateY(-1px)}
.choice.selected{background:rgba(59,130,246,0.25);border-color:rgba(59,130,246,0.4);box-shadow:0 4px 16px rgba(59,130,246,0.3);transform:scale(1.02)}
.choice.matched{background:rgba(155,229,106,0.15);border-color:rgba(155,229,106,0.3);opacity:0.7;pointer-events:none}
.choice.correct{background:linear-gradient(180deg,var(--lime1),var(--lime2));color:#04270b;border-color:var(--lime2);box-shadow:0 6px 20px rgba(155,229,106,0.35);animation:correctBounce 0.4s ease-out}
@keyframes correctBounce{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}
.choice.wrong{background:rgba(255,80,80,0.15);border-color:rgba(255,80,80,0.25);box-shadow:0 4px 12px rgba(255,80,80,0.2);animation:shake 0.3s ease-out}
.panelFooter{display:flex;justify-content:space-between;align-items:center;margin-top:16px;flex-wrap:wrap;gap:10px}
.btn{padding:10px 16px;border-radius:10px;border:0;cursor:pointer;font-size:14px;font-weight:500;transition:all .2s var(--accent-bezier)}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.08);color:var(--muted)}
.btn.ghost:hover{background:rgba(255,255,255,0.04);border-color:rgba(255,255,255,0.12)}
.btn.primary{background:linear-gradient(180deg,var(--lime1),var(--lime2));color:#04270b}
.btn.primary:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(155,229,106,0.3)}
.svgOverlay{position:absolute;inset:0;pointer-events:none}
.line{stroke:var(--lime2);stroke-width:8;stroke-linecap:round;fill:none;stroke-dasharray:600;stroke-dashoffset:600;transition:stroke-dashoffset .9s var(--accent-bezier)}
.trophy{position:absolute;left:50%;top:30%;transform:translate(-50%,-50%) scale(0);opacity:0;transition:transform .6s var(--accent-bezier),opacity .4s}
.trophy.show{transform:translate(-50%,-50%) scale(1);opacity:1}
.trophy .cup{font-size:56px}
.board.hidden{opacity:0;pointer-events:none}
@media(max-width:900px){.panel{width:94vw;padding:18px}.choice{padding:10px 14px;font-size:13px;min-height:42px}.q h4{font-size:13px}.matchContainer{grid-template-columns:1fr;gap:12px}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="brand">
      <h1>INTUITY</h1>
      <div class="sub">Quiz Battle Arena</div>
      <div class="author">Majid Nashtai</div>
    </div>
    <div class="statusBar">
      <div class="player" id="playerX"><div class="icon">‚úñ</div><div class="meta">Player X ‚Äì <strong id="scoreX">0</strong></div></div>
      <div class="player" id="playerO"><div class="icon">‚≠ï</div><div class="meta">Player O ‚Äì <strong id="scoreO">0</strong></div></div>
    </div>
  </div>

  <div class="boardWrap">
    <div class="board" id="board">
      <div class="boardHeader"><div class="small">Challenge Mode</div><div class="small">Turn: <strong id="turnLabel">X</strong></div></div>
      <div class="grid" id="grid"></div>
      <svg class="svgOverlay" viewBox="0 0 300 300" preserveAspectRatio="none"></svg>
      <div class="trophy" id="trophy"><div class="cup">üèÜ</div></div>
    </div>
    <div style="display:flex;align-items:center;gap:10px;margin-top:10px">
      <button class="btn ghost" id="resetBtn">Reset Game</button>
    </div>
  </div>
</div>

<div class="modal" id="modal">
  <div class="panel">
    <div class="panelHeader">
      <div>
        <div class="small" id="modalTopic">Topic</div>
        <div style="font-size:13px;color:rgba(255,255,255,0.85)" id="modalSub">5 questions</div>
      </div>
    </div>
    <div class="panelBody" id="panelBody"></div>
    <div class="panelFooter">
      <div class="small">Get all correct to claim tile!</div>
      <div style="display:flex;gap:8px">
        <button class="btn ghost" id="showAnswersBtn">Show Answers</button>
        <button class="btn ghost" id="closeBtn">Close</button>
        <button class="btn primary" id="submitBtn">Submit</button>
      </div>
    </div>
  </div>
</div>
<script>
const GRID_TOPICS=['Sport','English','Cities','English','Famous People','English','Countries','English','Music'];
const POOL={Sport:[[{type:'mcq',q:'Which sport uses a shuttlecock?',opts:['Tennis','Badminton','Squash','Table Tennis'],a:1},{type:'mcq',q:'How many players on a basketball court per team?',opts:['5','6','7','8'],a:0},{type:'match',q:'Match sport to equipment',pairs:[['Football','Goal'],['Cricket','Stumps'],['Tennis','Net'],['Golf','Hole']]},{type:'mcq',q:'In which sport do you slam dunk?',opts:['Volleyball','Basketball','Handball','Netball'],a:1},{type:'mcq',q:'Red card in football means?',opts:['Warning','Ejection','Penalty','Timeout'],a:1}],[{type:'mcq',q:'How many Olympic rings?',opts:['4','5','6','7'],a:1},{type:'match',q:'Match athlete to sport',pairs:[['Usain Bolt','Sprinting'],['Serena Williams','Tennis'],['Michael Phelps','Swimming'],['Messi','Football']]},{type:'mcq',q:'Stumps in cricket per end?',opts:['2','3','4','5'],a:1},{type:'mcq',q:'Sport played at Wimbledon?',opts:['Football','Cricket','Tennis','Rugby'],a:2},{type:'mcq',q:'Rugby try points?',opts:['3','4','5','6'],a:2}],[{type:'mcq',q:'Maximum break in snooker?',opts:['137','147','157','167'],a:1},{type:'mcq',q:'Butterfly stroke in which sport?',opts:['Diving','Gymnastics','Swimming','Surfing'],a:2},{type:'match',q:'Match sport to venue',pairs:[['Cricket','Oval'],['Tennis','Court'],['Swimming','Pool'],['Football','Stadium']]},{type:'mcq',q:'Holes in standard golf?',opts:['9','12','18','24'],a:2},{type:'mcq',q:'Which country invented baseball?',opts:['Canada','USA','Cuba','Japan'],a:1}],[{type:'mcq',q:'KO in boxing means?',opts:['Knockout','Technical knockout','Disqualified','Decision'],a:0},{type:'mcq',q:'Sets to win Wimbledon men?',opts:['2','3','4','5'],a:1},{type:'match',q:'Match term to sport',pairs:[['Ace','Tennis'],['Hat-trick','Football'],['Eagle','Golf'],['Strike','Bowling']]},{type:'mcq',q:'Basketball hoop height (feet)?',opts:['8','9','10','11'],a:2},{type:'mcq',q:'"Love" means zero in?',opts:['Badminton','Squash','Tennis','Table Tennis'],a:2}],[{type:'mcq',q:'Rugby union team players?',opts:['13','15','17','19'],a:1},{type:'mcq',q:'Longest track race?',opts:['5000m','10000m','15000m','Marathon'],a:1},{type:'match',q:'Match sport to surface',pairs:[['Ice Hockey','Ice'],['Volleyball','Court'],['Hockey','Grass'],['Basketball','Wood']]},{type:'mcq',q:'FIFA stands for?',opts:['Football International Federation','F√©d√©ration Internationale de Football','Federal Football Academy','Football Institute'],a:1},{type:'mcq',q:'Stanley Cup sport?',opts:['Basketball','Ice Hockey','Baseball','American Football'],a:1}]],Music:[[{type:'mcq',q:'Who sang "Shape of You"?',opts:['Ed Sheeran','Shawn Mendes','Justin Bieber','Harry Styles'],a:0},{type:'mcq',q:'Artist of "Bad Guy"?',opts:['Ariana Grande','Billie Eilish','Dua Lipa','Taylor Swift'],a:1},{type:'match',q:'Match artist to song',pairs:[['Taylor Swift','Anti-Hero'],['The Weeknd','Blinding Lights'],['Dua Lipa','Levitating'],['Harry Styles','As It Was']]},{type:'mcq',q:'Coldplay lead singer?',opts:['Chris Martin','Adam Levine','Bruno Mars','John Legend'],a:0},{type:'mcq',q:'K-pop group "Dynamite"?',opts:['BTS','Blackpink','EXO','Twice'],a:0}],[{type:'mcq',q:'Guitar strings?',opts:['4','5','6','7'],a:2},{type:'mcq',q:'88 keys instrument?',opts:['Keyboard','Organ','Piano','Synth'],a:2},{type:'match',q:'Match instrument family',pairs:[['Trumpet','Brass'],['Flute','Woodwind'],['Violin','String'],['Drums','Percussion']]},{type:'mcq',q:'Orchestra biggest instrument?',opts:['Tuba','Double Bass','Harp','Organ'],a:1},{type:'mcq',q:'Mouth organ is?',opts:['Flute','Harmonica','Piccolo','Recorder'],a:1}],[{type:'mcq',q:'Who sang "Uptown Funk"?',opts:['Bruno Mars','Jason Derulo','Pharrell','Usher'],a:0},{type:'match',q:'Match band to genre',pairs:[['Imagine Dragons','Alt Rock'],['One Direction','Boy Band'],['Twenty One Pilots','Alternative'],['Maroon 5','Pop Rock']]},{type:'mcq',q:'"Midnights" album artist?',opts:['Ariana Grande','Selena Gomez','Taylor Swift','Miley Cyrus'],a:2},{type:'mcq',q:'Queen of Pop?',opts:['Beyonc√©','Madonna','Lady Gaga','Rihanna'],a:1},{type:'mcq',q:'Rapper married to Beyonc√©?',opts:['Drake','Jay-Z','Kanye West','Travis Scott'],a:1}],[{type:'mcq',q:'"Tempo" means?',opts:['Volume','Speed','Pitch','Rhythm'],a:1},{type:'mcq',q:'Group of singers called?',opts:['Band','Choir','Orchestra','Ensemble'],a:1},{type:'match',q:'Match term to meaning',pairs:[['Solo','One performer'],['Duet','Two performers'],['Trio','Three performers'],['Quartet','Four performers']]},{type:'mcq',q:'Longest note duration?',opts:['Whole','Half','Quarter','Eighth'],a:0},{type:'mcq',q:'Lines music is written on?',opts:['Bar','Staff','Clef','Measure'],a:1}],[{type:'mcq',q:'Who sang "Flowers" 2023?',opts:['Miley Cyrus','Selena Gomez','Dua Lipa','Ariana Grande'],a:0},{type:'match',q:'Match artist nationality',pairs:[['Adele','British'],['Drake','Canadian'],['Bad Bunny','Puerto Rican'],['Post Malone','American']]},{type:'mcq',q:'Most popular music streaming?',opts:['Apple Music','Spotify','YouTube Music','Amazon Music'],a:1},{type:'mcq',q:'Shawn Mendes plays?',opts:['Piano','Drums','Guitar','Keyboard'],a:2},{type:'mcq',q:'Elvis helped popularize?',opts:['Jazz','Rock and Roll','Blues','Country'],a:1}]],Cities:[[{type:'mcq',q:'Capital of Kazakhstan?',opts:['Almaty','Nur-Sultan','Astana','Tashkent'],a:2},{type:'mcq',q:'Capital of Myanmar?',opts:['Yangon','Bangkok','Naypyidaw','Mandalay'],a:2},{type:'match',q:'Match capital to country',pairs:[['Canberra','Australia'],['Pretoria','South Africa'],['Ottawa','Canada'],['Bern','Switzerland']]},{type:'mcq',q:'Capital of Sri Lanka?',opts:['Colombo','Kandy','Sri Jayawardenepura Kotte','Galle'],a:2},{type:'mcq',q:'Capital of Nigeria?',opts:['Lagos','Abuja','Kano','Ibadan'],a:1}],[{type:'mcq',q:'City on two continents?',opts:['Cairo','Istanbul','Athens','Dubai'],a:1},{type:'match',q:'City features',pairs:[['Venice','Canals'],['Dubai','Desert towers'],['Singapore','Island'],['Amsterdam','Below sea']]},{type:'mcq',q:'Highest capital city?',opts:['Quito','Kathmandu','La Paz','Bogot√°'],a:2},{type:'mcq',q:'City on 14 islands?',opts:['Venice','Stockholm','Amsterdam','Copenhagen'],a:1},{type:'mcq',q:'Most populous African city?',opts:['Cairo','Lagos','Kinshasa','Johannesburg'],a:1}],[{type:'mcq',q:'"Pearl of Adriatic"?',opts:['Venice','Split','Dubrovnik','Trieste'],a:2},{type:'match',q:'City nicknames',pairs:[['New Orleans','Big Easy'],['Seattle','Emerald City'],['Detroit','Motor City'],['Las Vegas','Sin City']]},{type:'mcq',q:'"City of Hundred Spires"?',opts:['Prague','Budapest','Vienna','Krakow'],a:0},{type:'mcq',q:'"Granite City" UK?',opts:['Edinburgh','Glasgow','Aberdeen','Dundee'],a:2},{type:'mcq',q:'"Lion City" is?',opts:['Bangkok','Singapore','Hong Kong','Kuala Lumpur'],a:1}],[{type:'mcq',q:'Constantinople is now?',opts:['Athens','Istanbul','Damascus','Baghdad'],a:1},{type:'mcq',q:'Inca Empire capital?',opts:['Lima','Cusco','Machu Picchu','Quito'],a:1},{type:'match',q:'Ancient cities',pairs:[['Rome','Romans'],['Athens','Greeks'],['Cairo','Egyptians'],['Beijing','Chinese']]},{type:'mcq',q:'Oldest continuously inhabited?',opts:['Damascus','Jerusalem','Jericho','Athens'],a:0},{type:'mcq',q:'Pompeii destroyed by?',opts:['Earthquake','Vesuvius','Flood','War'],a:1}],[{type:'mcq',q:'Most visited city?',opts:['Paris','London','Bangkok','Dubai'],a:2},{type:'match',q:'City to river',pairs:[['London','Thames'],['Paris','Seine'],['Cairo','Nile'],['New York','Hudson']]},{type:'mcq',q:'Venice built on?',opts:['Mountains','Islands','Desert','Cliffs'],a:1},{type:'mcq',q:'Machu Picchu country?',opts:['Peru','Bolivia','Chile','Ecuador'],a:0},{type:'mcq',q:'Tallest building city?',opts:['Dubai','New York','Shanghai','Kuala Lumpur'],a:0}]],Countries:[[{type:'mcq',q:'Largest country by area?',opts:['Canada','China','Russia','USA'],a:2},{type:'mcq',q:'Most populous country?',opts:['India','China','USA','Indonesia'],a:0},{type:'match',q:'Country to continent',pairs:[['Brazil','S America'],['Egypt','Africa'],['Thailand','Asia'],['Germany','Europe']]},{type:'mcq',q:'Smallest country?',opts:['Monaco','Vatican City','Liechtenstein','San Marino'],a:1},{type:'mcq',q:'Country with most islands?',opts:['Philippines','Indonesia','Sweden','Japan'],a:2}],[{type:'mcq',q:'Which has no capital?',opts:['Vatican','Nauru','Monaco','Liechtenstein'],a:1},{type:'match',q:'Country currencies',pairs:[['Japan','Yen'],['UK','Pound'],['Mexico','Peso'],['India','Rupee']]},{type:'mcq',q:'Landlocked in Asia?',opts:['Mongolia','Myanmar','Vietnam','Pakistan'],a:0},{type:'mcq',q:'Longest coastline?',opts:['Russia','Canada','Indonesia','USA'],a:1},{type:'mcq',q:'African countries count?',opts:['44','54','64','74'],a:1}],[{type:'mcq',q:'Amazon rainforest mainly?',opts:['Colombia','Peru','Brazil','Venezuela'],a:2},{type:'mcq',q:'Mount Everest border?',opts:['India-China','Nepal-China','Pakistan-China','Bhutan-China'],a:1},{type:'match',q:'Landmark to country',pairs:[['Taj Mahal','India'],['Great Wall','China'],['Eiffel Tower','France'],['Statue of Liberty','USA']]},{type:'mcq',q:'Sahara Desert mainly in?',opts:['Egypt','Algeria','Libya','Morocco'],a:1},{type:'mcq',q:'Country in 4 hemispheres?',opts:['Indonesia','Ecuador','Kiribati','Kenya'],a:2}],[{type:'mcq',q:'Language in Brazil?',opts:['Spanish','Portuguese','French','English'],a:1},{type:'match',q:'Country shapes',pairs:[['Italy','Boot'],['Chile','Thin strip'],['Japan','Archipelago'],['Greece','Peninsula']]},{type:'mcq',q:'Home of kangaroos?',opts:['New Zealand','Australia','Papua New Guinea','Indonesia'],a:1},{type:'mcq',q:'Pyramids of Giza in?',opts:['Egypt','Sudan','Mexico','Guatemala'],a:0},{type:'mcq',q:'Largest island country?',opts:['Indonesia','Madagascar','Philippines','Japan'],a:0}],[{type:'mcq',q:'Neutral in both World Wars?',opts:['Sweden','Switzerland','Spain','Portugal'],a:1},{type:'mcq',q:'Youngest country (2011)?',opts:['Kosovo','South Sudan','East Timor','Montenegro'],a:1},{type:'match',q:'Country to flag colors',pairs:[['France','Blue-White-Red'],['Italy','Green-White-Red'],['Germany','Black-Red-Yellow'],['Spain','Red-Yellow-Red']]},{type:'mcq',q:'Land of rising sun?',opts:['China','Japan','South Korea','Thailand'],a:1},{type:'mcq',q:'Down Under refers to?',opts:['Australia','New Zealand','South Africa','Argentina'],a:0}]],'Famous People':[[{type:'mcq',q:'First man on moon?',opts:['Buzz Aldrin','Neil Armstrong','Yuri Gagarin','John Glenn'],a:1},{type:'mcq',q:'Painted Mona Lisa?',opts:['Michelangelo','Leonardo da Vinci','Raphael','Donatello'],a:1},{type:'match',q:'Person to achievement',pairs:[['Einstein','Relativity'],['Newton','Gravity'],['Darwin','Evolution'],['Galileo','Telescope']]},{type:'mcq',q:'Invented telephone?',opts:['Edison','Bell','Tesla','Marconi'],a:1},{type:'mcq',q:'Wrote Romeo & Juliet?',opts:['Dickens','Shakespeare','Austen','Twain'],a:1}],[{type:'mcq',q:'Youngest Nobel Peace Prize?',opts:['Malala','Obama','Mother Teresa','MLK'],a:0},{type:'match',q:'Leader to country',pairs:[['Churchill','UK'],['Gandhi','India'],['Mandela','S Africa'],['Lincoln','USA']]},{type:'mcq',q:'I have a dream speech?',opts:['Malcolm X','MLK','JFK','Obama'],a:1},{type:'mcq',q:'First female PM UK?',opts:['May','Thatcher','Truss','Merkel'],a:1},{type:'mcq',q:'Apple founder?',opts:['Gates','Jobs','Zuckerberg','Bezos'],a:1}],[{type:'mcq',q:'Harry Potter author?',opts:['Rowling','Tolkien','Lewis','Dahl'],a:0},{type:'mcq',q:'Facebook founder?',opts:['Musk','Zuckerberg','Dorsey','Bezos'],a:1},{type:'match',q:'Inventor to invention',pairs:[['Wright Bros','Airplane'],['Edison','Light bulb'],['Ford','Assembly line'],['Bell','Telephone']]},{type:'mcq',q:'Theory of evolution?',opts:['Darwin','Mendel','Lamarck','Wallace'],a:0},{type:'mcq',q:'Discovered penicillin?',opts:['Pasteur','Fleming','Curie','Jenner'],a:1}],[{type:'mcq',q:'Basketball icon 23?',opts:['LeBron','Kobe','Jordan','Magic'],a:2},{type:'match',q:'Artist to masterpiece',pairs:[['Van Gogh','Starry Night'],['Picasso','Guernica'],['Monet','Water Lilies'],['Da Vinci','Mona Lisa']]},{type:'mcq',q:'First woman in space?',opts:['Sally Ride','Valentina Tereshkova','Svetlana Savitskaya','Mae Jemison'],a:1},{type:'mcq',q:'Microsoft founder?',opts:['Jobs','Gates','Zuckerberg','Musk'],a:1},{type:'mcq',q:'Youngest self-made billionaire?',opts:['Zuckerberg','Kylie Jenner','Bezos','Musk'],a:1}],[{type:'mcq',q:'First Black US President?',opts:['Obama','Biden','Clinton','Bush'],a:0},{type:'mcq',q:'Titanic director?',opts:['Spielberg','Cameron','Nolan','Tarantino'],a:1},{type:'match',q:'Scientist to field',pairs:[['Hawking','Physics'],['Curie','Chemistry'],['Freud','Psychology'],['Turing','Computing']]},{type:'mcq',q:'Wrote 1984?',opts:['Huxley','Orwell','Bradbury','Atwood'],a:1},{type:'mcq',q:'Most Olympic golds?',opts:['Bolt','Phelps','Biles','Ohno'],a:1}]],English:[[{type:'mcq',q:'Past tense of "go"?',opts:['goed','went','gone','going'],a:1},{type:'mcq',q:'"Their" vs "There" - ownership?',opts:['Their','There','They\'re','Thier'],a:0},{type:'match',q:'Match word to synonym',pairs:[['Happy','Joyful'],['Sad','Unhappy'],['Big','Large'],['Small','Tiny']]},{type:'mcq',q:'Plural of "child"?',opts:['childs','childes','children','childrens'],a:2},{type:'mcq',q:'Which is correct?',opts:['I seen it','I saw it','I have saw it','I did saw it'],a:1}],[{type:'mcq',q:'"Give up" means?',opts:['Donate','Quit','Surrender','All above'],a:3},{type:'match',q:'Phrasal verb meanings',pairs:[['Look after','Care for'],['Put off','Postpone'],['Turn down','Reject'],['Run into','Meet']]},{type:'mcq',q:'"Break down" means?',opts:['Destroy','Stop working','Analyze','All above'],a:3},{type:'mcq',q:'Complete: "Can you ___ the TV?"',opts:['turn up','turn off','turn down','All correct'],a:3},{type:'mcq',q:'"Figure out" means?',opts:['Calculate','Understand','Solve','All above'],a:3}],[{type:'mcq',q:'Simile uses?',opts:['like/as','is/are','very/much','than/then'],a:0},{type:'mcq',q:'Metaphor example?',opts:['Fast as wind','Time is money','She runs quickly','Very tired'],a:1},{type:'match',q:'Literary devices',pairs:[['Simile','Like/as comparison'],['Metaphor','Direct comparison'],['Hyperbole','Exaggeration'],['Personification','Human traits']]},{type:'mcq',q:'Alliteration is?',opts:['Rhyming','Repetition of sounds','Exaggeration','Comparison'],a:1},{type:'mcq',q:'"The sun smiled" is?',opts:['Simile','Metaphor','Personification','Hyperbole'],a:2}],[{type:'mcq',q:'Antonym of "difficult"?',opts:['Hard','Easy','Complex','Tough'],a:1},{type:'match',q:'Antonyms',pairs:[['Hot','Cold'],['Fast','Slow'],['Strong','Weak'],['Light','Dark']]},{type:'mcq',q:'Synonym of "beautiful"?',opts:['Ugly','Pretty','Plain','Simple'],a:1},{type:'mcq',q:'"Huge" means?',opts:['Tiny','Very big','Medium','Small'],a:1},{type:'mcq',q:'Opposite of "empty"?',opts:['Full','Vacant','Bare','Hollow'],a:0}],[{type:'mcq',q:'"Its" vs "It\'s" - contraction?',opts:['Its','It\'s','Itz','Its\''],a:1},{type:'mcq',q:'Which is wrong?',opts:['You\'re nice','Your nice','They\'re here','We\'re ready'],a:1},{type:'match',q:'Correct usage',pairs:[['Their','Belonging to them'],['There','Location'],['They\'re','They are'],['Your','Belonging to you']]},{type:'mcq',q:'"Should of" is wrong. Correct is?',opts:['Should off','Should have','Should\'ve only','B and C'],a:3},{type:'mcq',q:'Correct: "Between you and ___"',opts:['I','me','myself','meself'],a:1}],[{type:'mcq',q:'Noun is?',opts:['Action','Person/place/thing','Describing word','Connecting'],a:1},{type:'match',q:'Parts of speech',pairs:[['Verb','Action'],['Adjective','Describes noun'],['Adverb','Describes verb'],['Noun','Person/thing']]},{type:'mcq',q:'Adjective example?',opts:['Run','Quickly','Beautiful','Happiness'],a:2},{type:'mcq',q:'"Quickly" is a/an?',opts:['Noun','Verb','Adjective','Adverb'],a:3},{type:'mcq',q:'Verb in "She runs fast"?',opts:['She','runs','fast','She runs'],a:1}],[{type:'mcq',q:'If I ___ rich, I\'d travel.',opts:['am','was','were','be'],a:2},{type:'mcq',q:'She ___ to school yesterday.',opts:['go','goes','went','going'],a:2},{type:'match',q:'Tense to example',pairs:[['Present','I walk'],['Past','I walked'],['Future','I will walk'],['Present continuous','I am walking']]},{type:'mcq',q:'By tomorrow, I ___ finished.',opts:['will have','will','would','had'],a:0},{type:'mcq',q:'He ___ here for 5 years.',opts:['is','was','has been','will be'],a:2}]]};
let playerTurn='X',scores=JSON.parse(localStorage.getItem('intuity_scores')||'{}');if(!scores.X)scores={X:0,O:0};
let boardState=Array(9).fill(null),winsDrawn=false,matchingState={firstClick:null,pairs:[],answered:false};
let cellAttempts={},currentLoadedSetId=null,activeIndex=null;
const grid=document.getElementById('grid'),modal=document.getElementById('modal'),panelBody=document.getElementById('panelBody');
const modalTopic=document.getElementById('modalTopic'),modalSub=document.getElementById('modalSub');

for(let i=0;i<9;i++){
  const cell=document.createElement('div');
  cell.className='cell';cell.dataset.index=i;cell.dataset.topic=GRID_TOPICS[i];
  const lab=document.createElement('div');lab.className='label';lab.textContent=GRID_TOPICS[i];
  const sym=document.createElement('div');sym.className='symbol';sym.textContent='+';
  cell.append(lab,sym);grid.appendChild(cell);
}

function updatePlayerHighlight(){
  document.getElementById('playerX').classList.toggle('active',playerTurn==='X');
  document.getElementById('playerO').classList.toggle('active',playerTurn==='O');
}

function getRandomQuestionSet(cellIndex){
  const topic=GRID_TOPICS[cellIndex],questionSets=POOL[topic]||[];
  if(questionSets.length===0)return null;
  if(!cellAttempts[cellIndex])cellAttempts[cellIndex]=[];
  const usedIds=cellAttempts[cellIndex],availableIds=[];
  for(let i=0;i<questionSets.length;i++)if(!usedIds.includes(i))availableIds.push(i);
  if(availableIds.length===0){cellAttempts[cellIndex]=[];for(let i=0;i<questionSets.length;i++)availableIds.push(i);}
  const randomId=availableIds[Math.floor(Math.random()*availableIds.length)];
  cellAttempts[cellIndex].push(randomId);
  return{id:randomId,questions:questionSets[randomId]};
}

function openModal(index){
  if(boardState[index]&&boardState[index].perfect)return;
  activeIndex=index;matchingState={firstClick:null,pairs:[],answered:false};
  const topic=GRID_TOPICS[index];modalTopic.textContent=topic;
  const questionSet=getRandomQuestionSet(index);
  if(!questionSet){alert('No questions available!');return;}
  currentLoadedSetId=questionSet.id;modalSub.textContent=`${questionSet.questions.length} questions`;
  renderQuestions(questionSet.questions);modal.classList.add('show');
  document.getElementById('board').classList.add('hidden');
  document.querySelector(`.cell[data-index='${index}']`).classList.add('activeEdge');
}

function closeModal(){
  modal.classList.remove('show');document.getElementById('board').classList.remove('hidden');
  if(activeIndex!==null)document.querySelector(`.cell[data-index='${activeIndex}']`).classList.remove('activeEdge');
  activeIndex=null;currentLoadedSetId=null;matchingState={firstClick:null,pairs:[],answered:false};
}

function showAnswers(){
  if(activeIndex===null)return;
  const topic=GRID_TOPICS[activeIndex],questionSets=POOL[topic]||[],qset=questionSets[currentLoadedSetId]||[];
  const qDivs=Array.from(panelBody.querySelectorAll('.q'));
  qset.forEach((q,i)=>{
    const qdiv=qDivs[i];if(!qdiv)return;
    if(q.type==='mcq'){
      const all=qdiv.querySelectorAll('.choice');
      all.forEach(ch=>{ch.classList.remove('selected','wrong');if(Number(ch.dataset.sel)===q.a)ch.classList.add('correct');});
    }else if(q.type==='match'){
      const choices=qdiv.querySelectorAll('.choice');
      choices.forEach(ch=>ch.classList.remove('selected','matched','wrong'));
      q.pairs.forEach(pair=>choices.forEach(ch=>{if(ch.dataset.value===pair[0]||ch.dataset.value===pair[1])ch.classList.add('correct');}));
      qdiv.dataset.pairs=JSON.stringify(q.pairs.map(p=>[p[0],p[1]]));
    }
  });
}

function renderQuestions(qset){
  panelBody.innerHTML='';
  qset.forEach((q,i)=>{
    const qdiv=document.createElement('div');qdiv.className='q';qdiv.dataset.qindex=i;
    const h=document.createElement('h4');h.textContent=`Q${i+1}. ${q.q}`;qdiv.appendChild(h);
    if(q.type==='mcq'){
      const ch=document.createElement('div');ch.className='choices';
      q.opts.forEach((opt,oi)=>{
        const b=document.createElement('button');b.className='choice';b.textContent=opt;b.dataset.sel=oi;
        b.addEventListener('click',()=>onSelectChoice(b,q,i));ch.appendChild(b);
      });
      qdiv.appendChild(ch);
    }else if(q.type==='match'){
      const container=document.createElement('div');container.className='matchContainer';
      const left=document.createElement('div');left.className='matchLeft';
      const shuffledLeft=q.pairs.slice().sort(()=>0.5-Math.random());
      shuffledLeft.forEach((p,pi)=>{
        const item=document.createElement('button');item.className='choice';item.textContent=p[0];
        item.dataset.value=p[0];item.dataset.side='left';item.dataset.leftindex=pi;
        item.addEventListener('click',()=>onMatchClick(item,qdiv,q));left.appendChild(item);
      });
      const right=document.createElement('div');right.className='matchRight';
      const shuffledRight=q.pairs.slice().sort(()=>0.5-Math.random());
      shuffledRight.forEach((p,pi)=>{
        const b=document.createElement('button');b.className='choice';b.textContent=p[1];
        b.dataset.value=p[1];b.dataset.side='right';b.dataset.rightindex=pi;
        b.addEventListener('click',()=>onMatchClick(b,qdiv,q));right.appendChild(b);
      });
      container.append(left,right);qdiv.appendChild(container);
    }
    panelBody.appendChild(qdiv);
  });
}

function onSelectChoice(btn,q,i){
  const parent=btn.parentElement;
  parent.querySelectorAll('.choice').forEach(x=>x.classList.remove('selected'));
  btn.classList.add('selected');btn.closest('.q').dataset.selected=btn.dataset.sel;
}

function onMatchClick(btn,qdiv,q){
  if(btn.classList.contains('matched'))return;
  if(!matchingState.firstClick){btn.classList.add('selected');matchingState.firstClick=btn;}
  else if(btn===matchingState.firstClick){btn.classList.remove('selected');matchingState.firstClick=null;}
  else if(btn.dataset.side===matchingState.firstClick.dataset.side){
    matchingState.firstClick.classList.remove('selected');btn.classList.add('selected');matchingState.firstClick=btn;
  }else{
    const first=matchingState.firstClick,second=btn;
    first.classList.remove('selected');first.classList.add('matched');second.classList.add('matched');
    matchingState.pairs.push([first.dataset.value,second.dataset.value]);matchingState.firstClick=null;
    qdiv.dataset.pairs=JSON.stringify(matchingState.pairs);
  }
}

function submitAnswers(){
  if(activeIndex===null)return;
  const topic=GRID_TOPICS[activeIndex],questionSets=POOL[topic]||[],qset=questionSets[currentLoadedSetId]||[];
  const qDivs=Array.from(panelBody.querySelectorAll('.q'));let correctCount=0;
  qset.forEach((q,i)=>{
    const qdiv=qDivs[i];if(!qdiv)return;
    if(q.type==='mcq'){
      const sel=qdiv.querySelector('.choice.selected');
      if(sel&&Number(sel.dataset.sel)===q.a){correctCount++;sel.classList.add('correct');}
      else{if(sel)sel.classList.add('wrong');
        qdiv.querySelectorAll('.choice').forEach(ch=>{if(Number(ch.dataset.sel)===q.a)ch.classList.add('correct');});}
    }else if(q.type==='match'){
      const pairs=JSON.parse(qdiv.dataset.pairs||'[]');let allCorrect=true;
      if(pairs.length!==q.pairs.length)allCorrect=false;
      else pairs.forEach(userPair=>{if(!q.pairs.some(correctPair=>userPair.includes(correctPair[0])&&userPair.includes(correctPair[1])))allCorrect=false;});
      const choices=qdiv.querySelectorAll('.choice');
      if(allCorrect){correctCount++;choices.forEach(ch=>ch.classList.add('correct'));}
      else choices.forEach(ch=>{if(ch.classList.contains('matched'))ch.classList.add('wrong');});
    }
  });
  const perfect=correctCount===qset.length;
  if(perfect)awardTile(activeIndex);
  setTimeout(()=>{clearPanelVisuals();closeModal();if(perfect)flashCellPerfect(activeIndex);},1800);
}

function clearPanelVisuals(){
  panelBody.querySelectorAll('.q').forEach(q=>{
    q.querySelectorAll('.choice').forEach(ch=>ch.classList.remove('wrong','correct','selected','matched'));
    q.dataset.pairs='';
  });
  matchingState={firstClick:null,pairs:[],answered:false};
}

function flashCellPerfect(idx){
  const cell=document.querySelector(`.cell[data-index='${idx}']`);
  cell.classList.add('perfect');setTimeout(()=>cell.classList.remove('perfect'),600);
}

function awardTile(idx){
  boardState[idx]={owner:playerTurn,perfect:true};renderBoard();
  scores[playerTurn]=(scores[playerTurn]||0)+1;
  document.getElementById(playerTurn==='X'?'scoreX':'scoreO').textContent=scores[playerTurn];
  localStorage.setItem('intuity_scores',JSON.stringify(scores));playCorrect();checkWin();
  playerTurn=playerTurn==='X'?'O':'X';document.getElementById('turnLabel').textContent=playerTurn;
  updatePlayerHighlight();
}

function renderBoard(){
  document.querySelectorAll('.cell').forEach((cell,i)=>{
    const s=boardState[i],sym=cell.querySelector('.symbol');
    cell.classList.remove('claimed-X','claimed-O');
    if(s){cell.classList.add('claimed-'+s.owner);sym.textContent=s.owner==='X'?'‚úñ':'‚≠ï';}
    else sym.textContent='+';
  });
}

const WINS=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
function checkWin(){
  const owners=boardState.map(v=>v?v.owner:null);
  for(const line of WINS){
    if(line.every(i=>owners[i]===owners[line[0]]&&owners[i]!==null)){drawLine(line);showTrophy();break;}
  }
}

function drawLine(line){
  const svg=document.querySelector('.svgOverlay');svg.innerHTML='';
  const cells=Array.from(document.querySelectorAll('.cell'));
  const p1=centerOf(cells[line[0]]),p3=centerOf(cells[line[2]]);
  const gridRect=grid.getBoundingClientRect(),scaleX=300/gridRect.width,scaleY=300/gridRect.height;
  const x1=(p1.x-gridRect.left)*scaleX,y1=(p1.y-gridRect.top)*scaleY;
  const x2=(p3.x-gridRect.left)*scaleX,y2=(p3.y-gridRect.top)*scaleY;
  const ln=document.createElementNS('http://www.w3.org/2000/svg','line');
  ln.setAttribute('x1',x1);ln.setAttribute('y1',y1);ln.setAttribute('x2',x2);ln.setAttribute('y2',y2);
  ln.classList.add('line');svg.appendChild(ln);setTimeout(()=>ln.style.strokeDashoffset='0',60);winsDrawn=true;
}

function centerOf(el){const r=el.getBoundingClientRect();return{x:(r.left+r.right)/2,y:(r.top+r.bottom)/2};}
function showTrophy(){
  const t=document.getElementById('trophy');t.classList.add('show');playWin();
  setTimeout(()=>t.classList.remove('show'),3800);
}

document.getElementById('resetBtn').addEventListener('click',()=>{
  boardState=Array(9).fill(null);playerTurn='X';cellAttempts={};scores={X:0,O:0};
  localStorage.setItem('intuity_scores',JSON.stringify(scores));
  document.getElementById('scoreX').textContent='0';document.getElementById('scoreO').textContent='0';
  document.getElementById('turnLabel').textContent='X';document.querySelector('.svgOverlay').innerHTML='';
  updatePlayerHighlight();renderBoard();
});

const audioCtx=(window.AudioContext||window.webkitAudioContext)?new(window.AudioContext||window.webkitAudioContext)():null;
function playTone(freq,dur){
  if(!audioCtx)return;const o=audioCtx.createOscillator(),g=audioCtx.createGain();
  o.type='sine';o.frequency.value=freq;g.gain.value=0.02;o.connect(g);g.connect(audioCtx.destination);
  o.start();o.stop(audioCtx.currentTime+dur);
}
function playCorrect(){playTone(1100,0.09);setTimeout(()=>playTone(1300,0.09),100);}
function playWin(){playTone(1200,0.12);setTimeout(()=>playTone(1400,0.12),140);setTimeout(()=>playTone(1600,0.15),280);}
function vibrate(ms){if(navigator.vibrate)navigator.vibrate(ms);}

document.getElementById('closeBtn').addEventListener('click',closeModal);
document.getElementById('showAnswersBtn').addEventListener('click',showAnswers);
document.getElementById('submitBtn').addEventListener('click',submitAnswers);
document.querySelectorAll('.cell').forEach(c=>c.addEventListener('click',()=>{
  const idx=+c.dataset.index;if(boardState[idx]&&boardState[idx].perfect)return;
  vibrate(10);playTone(800,0.03);openModal(idx);
}));

updatePlayerHighlight();renderBoard();
document.getElementById('scoreX').textContent=scores.X;
document.getElementById('scoreO').textContent=scores.O;
</script>
</body>
</html>
